<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<title>BOI Mumbai Branch Map</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

<style>
html, body {
  height: 100%;
  margin: 0;
  font-family: "Segoe UI", Arial, sans-serif;
}

/* HEADER */
header {
  background: #0d47a1;
  color: #fff;
  padding: 12px 16px;
  font-size: 18px;
}

/* TOP BAR */
#topbar {
  display: flex;
  gap: 10px;
  padding: 8px;
  background: #f1f3f4;
}

#search {
  flex: 1;
  padding: 8px;
  font-size: 14px;
}

#menuBtn {
  padding: 8px 12px;
  background: #0d47a1;
  color: #fff;
  border: none;
  cursor: pointer;
  font-size: 14px;
}

/* MAP */
#map {
  height: calc(100vh - 104px);
}

/* SIDEBAR DRAWER */
#sidebar {
  position: fixed;
  top: 0;
  left: -320px;
  width: 300px;
  height: 100%;
  background: #ffffff;
  box-shadow: 3px 0 10px rgba(0,0,0,0.3);
  z-index: 1000;
  transition: left 0.3s ease;
  overflow-y: auto;
}

#sidebar.open {
  left: 0;
}

#sidebar h3 {
  margin: 0;
  padding: 14px;
  background: #0d47a1;
  color: #fff;
}

.branch {
  padding: 10px 14px;
  border-bottom: 1px solid #eee;
  cursor: pointer;
}

.branch:hover {
  background: #e3f2fd;
}

/* OVERLAY */
#overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.3);
  display: none;
  z-index: 900;
}

#overlay.show {
  display: block;
}
</style>
</head>

<body>

<header>BOI – Mumbai Branch Locator</header>

<div id="topbar">
  <button id="menuBtn">☰ Branches</button>
  <input id="search" placeholder="Search branch name">
</div>

<div id="map"></div>

<div id="overlay"></div>

<div id="sidebar">
  <h3>Branch List</h3>
  <div id="branchList"></div>
</div>

<script>
let map = L.map("map").setView([19.076, 72.8777], 11);
L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
  maxZoom: 19
}).addTo(map);

const sidebar = document.getElementById("sidebar");
const overlay = document.getElementById("overlay");
const branchList = document.getElementById("branchList");

let markers = [];

/* ---------- SIDEBAR CONTROL ---------- */
function openSidebar() {
  sidebar.classList.add("open");
  overlay.classList.add("show");
}

function closeSidebar() {
  sidebar.classList.remove("open");
  overlay.classList.remove("show");
}

document.getElementById("menuBtn").onclick = openSidebar;
overlay.onclick = closeSidebar;

/* ---------- LOAD EXCEL ---------- */
fetch("./branches.xlsx")
  .then(r => r.arrayBuffer())
  .then(data => {
    const wb = XLSX.read(data, { type: "array" });
    const sheet = wb.Sheets[wb.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet, { defval: "" });

    plotBranches(rows);
  });

function plotBranches(rows) {
  const bounds = L.latLngBounds();
  branchList.innerHTML = "";

  rows.forEach(row => {
    const name = String(row.BranchName).trim();
    const lat = parseFloat(String(row.Latitude).trim());
    const lng = parseFloat(String(row.Longitude).trim());

    if (!name || isNaN(lat) || isNaN(lng)) return;

    const marker = L.marker([lat, lng])
      .addTo(map)
      .bindPopup(`<b>${name}</b>`);

    marker.branchName = name.toLowerCase();
    markers.push(marker);
    bounds.extend([lat, lng]);

    const div = document.createElement("div");
    div.className = "branch";
    div.textContent = name;

    div.onclick = () => {
      map.setView([lat, lng], 15);
      marker.openPopup();
      closeSidebar();
    };

    branchList.appendChild(div);
  });

  map.fitBounds(bounds);
}

/* ---------- SEARCH ---------- */
document.getElementById("search").addEventListener("input", function () {
  const q = this.value.toLowerCase().trim();
  if (!q) return;

  const match = markers.find(m => m.branchName.includes(q));
  if (match) {
    map.setView(match.getLatLng(), 15);
    match.openPopup();
    closeSidebar();
  }
});
</script>

</body>
</html>